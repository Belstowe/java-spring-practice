# Основы разработки ПО при помощи Java

## Весенний семестр. 2021-2022 гг.

Ковалев Максим Игоревич, гр. ИВ-923.

## Курсовая работа

Приложение мониторинга сетевых сервисов с интерфейсом управления и мониторинга в виде web-страницы.

## Этапы

1. ~~Получение и регулярное обновление системной информации;~~
2. ~~Вывод метрик в консоль;~~
3. ~~Настройка через файл выводимых метрик;~~
4. ~~Запись логов в БД *(CQL)*;~~
5. ~~Веб-интерфейс с использованием **Spring Boot**.~~

## Сборка и запуск

1. Необходимо иметь запущенную CQL-базу данных, открытую по порту 9042. В корневой директории прилагается файл с тестовым образом *ScyllaDB*, который можно использовать для дальнейшего тестирования.
```sh
docker-compose up
```

2. Далее достаточно запустить сборку Gradle. Ниже приведён запуск всей программы в фоновом режиме.
```sh
gradle build
gradle run & gradle bootRun &
```

3. Веб-интерфейс в данном тестовом режиме можно открыть по адресу `127.0.0.1:8080`.

Данная работа представляет собой связку из двух проектов, **консольной утилиты мониторинга системных метрик** *(metrics)* и **веб-интерфейса** *(web)*.

Консольная программа при самостоятельном запуске будет выкладывать логи с актуальными метриками в консоль (в формате YAML).

## Структура программы

### dns

<table>
  <tr>
    <th><code>PingUtility</code></th>
    <td>Статический класс, разработанный в предыдущих лабораторных работах. Используя консольную утилиту <code>ping</code>, класс измеряет время, которое занимает передача ICMP-пакета от узла до сервера с некоторым доменом.</td>
  </tr>
</table>

### sysmetrics

<table>
  <tr>
    <th><code>ConsoleLog</code></th>
    <td>Входной пункт в программу. Используя файл настроек <code>settings.toml</code>, инициализирует сборщик метрик о системе <code>SysInfoGatherer</code>, а затем каждые 3 секунды запрашивает обновление данных у сборщика и выводит их в консоль.</td>
  </tr>
  <tr>
    <th><code>SysInfoGatherer</code></th>
    <td>Сборщик метрик о системе. Для настройки сборщика используется внутренний класс <code>Builder</code>, через который указывается, какие метрики необходимы и куда передавать логи. Информация на текущий момент времени возвращается через метод <code>updateMetrics</code>. Поддерживаются <b>нагрузка на сетевые интерфейсы, нагрузка процессора, потребление оперативной памяти, заполнение диска, отслеживание задержки запросов до DNS-серверов</b>. Все записи логируются в базу данных <code>SysInfoDB</code>, если таковая была указана через <code>Builder</code>.</td>
  </tr>
  <tr>
    <th><code>SysInfoDB</code></th>
    <td>Интерфейс БД, который использует сборщик. Подразумевается структура из таблиц-групп (например, нагрузка на сетевые интерфейсы) и столбцов-метрик (например, число полученных/отправленных байт по интерфейсу <code>wlan0</code>). Ожидается, что БД будет индексировать записи по времени для быстрого сбора метрик по некоторому диапазону времени.</td>
  </tr>
  <tr>
    <th><code>SysInfoCQL</code></th>
    <td>Реализация внешнего БД, использующего язык запросов <b>CQL</b>: известные представители <b>Apache Cassandra</b>, <b>ScyllaDB</b> и <b>DataStax</b>. При инициализации требует адрес подключения. Опционально: пространство имён, имя/пароль.</td>
  </tr>
</table>

### web

<table>
  <tr>
    <th><code>WebApplication</code></th>
    <td>Входной пункт в Spring Boot-программу. Более ничего интересного не представляет.</td>
  </tr>
  <tr>
    <th><code>metrics.MetricsController</code></th>
    <td>Класс, организующий соединение с БД и чтение метрик для веб-страницы. Также отвечает на запросы к индексовой странице и странице с метриками.</td>
  </tr>
</table>

Отдельный интерес может представить Thymeleaf HTML файл по пути *"web/src/resources/templates/show-metrics.html"*. Является шаблоном страницы с метриками.